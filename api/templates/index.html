<html>
<head>
    <title>lil analytics</title>
    <link href="{{ url_for('static', path='/style.css') }}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script type="text/javascript" src=""></script>
</head>
<body>
    <h1>lil analytics dashboard</h1>
    <p>{{ timestamp }}</p>
    <p>server <strong id="statBname"></strong> is owned by <strong id="statBowner"></strong>.</p>
    <p>total messages: <strong id="statA"></strong> deleted: <strong id="statAdeleted"></strong></p>

    <canvas id="chart-a" width="300" height="300"></canvas>
<script>
    // TODO should have a menu to select server from available servers! then set this value to that.
    // pass all server_id and their names into template, create a dropdown menu, when on select -> run functions!
    // set this server_id to selected_id!
    var server_id = '686598539136073780';

    const statA = async () => {
        const response = await fetch('/stats/server-total-messages/' + server_id);
        const d = await response.json();
        document.getElementById("statA").textContent=d["total_messages"]
        document.getElementById("statAdeleted").textContent=d["total_deleted"]

    }

    const statB = async () => {
        const response = await fetch('/stats/server/' + server_id);
        const d = await response.json();
        document.getElementById("statBname").textContent=d["name"]
        document.getElementById("statBowner").textContent=d["owner_name"]
    }

    const chartA = async () => {
        const response = await fetch('/charts/server-channel-messages/' + server_id);
        const dataChartA = await response.json(); //extract JSON from the http response
        new Chart(document.getElementById("chart-a"), {
            type: 'horizontalBar',
            data: {
              labels: dataChartA["labels"],
              datasets: [
                {
                  label: "# of messages",
                  data: dataChartA["data"]
                }
              ]
            },
            options: {
              legend: { display: false },
              title: {
                display: true,
                text: 'total amount of messages per channel'
              }
            }
        });
    }

    statA()
    statB()
    chartA()


</script>

</body>
</html>